let monthName=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],currentDate=new Date,currentMonth=currentDate.getMonth()+1,currentDay=currentDate.getDate(),monthNumber=currentDate.getMonth(),currentYear=currentDate.getFullYear();var numeros=Array();let selectMonth,dia;function convertDateMysql(e){const t=e.split("/"),a=t[0],n=t[1];return t[2]+"-"+n.padStart(2,"0")+"-"+a.padStart(2,"0")}function convertDateJS(e){return new Date(Date.parse(e.replace(/-/g,"/")))}function formato(e){return e.replace(/^(\d{4})-(\d{2})-(\d{2})$/g,"$3/$2/$1")}!function(){!async function(){try{const t="/api/tareas?id="+c(),a=await fetch(t),r=await a.json();e=r.tareas,n()}catch(e){console.log(e)}}();let e=[],t=[];document.querySelector("#agregar-tarea").addEventListener("click",(function(){r()}));function a(a){const r=a.target.value;t=""!==r?e.filter(e=>e.estado===r):[],n()}function n(){!function(){const e=document.querySelector("#listado-tareas");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const t=e.filter(e=>"0"===e.estado),a=document.querySelector("#pendientes");0===t.length?a.disable=!0:a.disable=!1}(),function(){const t=e.filter(e=>"1"===e.estado),a=document.querySelector("#completadas");0===t.length?a.disable=!0:a.disable=!1}();const a=t.length?t:e;if(0===a.length){const e=document.querySelector("#listado-tareas"),t=document.createElement("LI");return t.textContent="No hay tareas",t.classList.add("no-tareas"),void e.appendChild(t)}const o={0:"Pendiente",1:"Completa"};a.forEach(t=>{const a=document.createElement("LI");a.dataset.tareaid=t.id,a.classList.add("tarea");const i=document.createElement("P");i.textContent=t.nombre,i.ondblclick=function(){r(editar=!0,{...t})};const l=document.createElement("P");l.textContent=formato(t.fecha);const s=document.createElement("DIV");s.classList.add("opciones");const m=document.createElement("BUTTON");m.classList.add("estado-tarea"),m.classList.add(""+o[t.estado].toLowerCase()),m.textContent=o[t.estado],m.dataset.estadoTarea=t.estado,m.ondblclick=function(){!function(e){const t="1"===e.estado?"0":"1";e.estado=t,d(e)}({...t})},btnEliminarTarea=document.createElement("BUTTON"),btnEliminarTarea.classList.add("eliminar-tarea"),btnEliminarTarea.dataset.idTarea=t.id,btnEliminarTarea.textContent="Eliminar",btnEliminarTarea.ondblclick=function(){!function(t){Swal.fire({title:"多Eliminar Tarea?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(a=>{a.isConfirmed&&async function(t){const a=new FormData,{id:r,nombre:o,fecha:d,estado:i}=t;a.append("id",r),a.append("nombre",o),a.append("fecha",d),a.append("estado",i),a.append("proyectoid",c());try{const r="http://localhost:3000/api/tareas/eliminar",o=await fetch(r,{method:"POST",body:a}),c=await o.json();c.resultado&&(Swal.fire("Eliminado",c.mensaje,"success"),e=e.filter(e=>e.id!==t.id),n())}catch(e){console.log(e)}}(t)})}({...t})},s.appendChild(m),s.appendChild(btnEliminarTarea),a.appendChild(i),a.appendChild(l),a.appendChild(s);document.querySelector("#listado-tareas").appendChild(a)})}function r(t=!1,a={}){const r=document.createElement("DIV");r.classList.add("modal"),r.innerHTML=`\n        <form class="formulario nueva-tarea">\n           <legend>${t?"Editar Tarea":"A単ade Nueva Tarea"}</legend>\n           <div class="campo">\n             \n             <input type="text name="tarea" placeholder="${a.nombre?"Edita la tarea":"A単adir Tarea al Proyecto"}" id="tarea"\n             value="${a.nombre?a.nombre:""}"/>\n           </div>\n           <div class="calendar">\n             <div class="calendar_info">\n                <div class="calendar_prev" id="prev_month">&#9664;</div>\n                <div class="calendar_month" id="month"></div>\n                <div class="calendar_year" id="year"></div>\n                <div class="calendar_next" id="next_month">&#9654;</div>\n             </div>\n\n             <div class="calendar_week">\n                <div class="calendar_day calendar_item">Lun</div>\n                <div class="calendar_day calendar_item">Mart</div>\n                <div class="calendar_day calendar_item">Mier</div>\n                <div class="calendar_day calendar_item">Juev</div>\n                <div class="calendar_day calendar_item">Vier</div>\n                <div class="calendar_day calendar_item">Sab</div>\n                <div class="calendar_day calendar_item">Dom</div>\n             </div>\n              <div class="calendar_dates" id="dates"></div>\n           </div>\n           <div class="opciones">\n              <input type="submit" class="submit-nueva-tarea" value="${a.nombre?"Guardar Cambios":"A単adir Tarea"}"/>\n              <button class="cerrar-modal" type="button">Cancelar</button>\n           </div>\n        </form> `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),setTimeout(()=>{t?i(!0,a):i(!1,a={})},0),r.addEventListener("click",(function(i){if(i.preventDefault(),i.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{r.remove()},500)}if(i.target.classList.contains("submit-nueva-tarea")){const r=document.querySelector("#tarea").value.trim();if(""===r)return void o("La Tarea es Obligatoria","error",document.querySelector(".formulario legend"));if(t)if(a.nombre=r,void 0===dia)d(a);else{let e=document.querySelector("#year").textContent;var l=convertDateMysql(new Date(e,selectMonth,dia).toLocaleDateString());a.fecha=l,d(a)}else{if(void 0===dia)return void o("Selecciona una fecha","error",document.querySelector(".formulario legend"));let t=document.querySelector("#year").textContent;!async function(t,a){const r=new FormData;r.append("nombre",t),r.append("fecha",a),r.append("proyectoid",c());try{const c="http://localhost:3000/api/tareas",d=await fetch(c,{method:"POST",body:r}),i=await d.json();if(o(i.mensaje,i.tipo,document.querySelector(".formulario legend")),"exito"===i.tipo){const r=document.querySelector(".modal");setTimeout(()=>{r.remove()},3e3);const o={id:String(i.id),nombre:t,fecha:a,estado:"0",proyectoid:i.proyectoid};e=[...e,o],n()}}catch(e){console.log(e)}}(r,l=convertDateMysql(new Date(t,selectMonth,dia).toLocaleDateString()))}}i.target.classList.contains("calendar_prev")&&function(){0!==monthNumber?monthNumber--:(monthNumber=11,currentYear--);s()}(),i.target.classList.contains("calendar_next")&&function(){11!==monthNumber?monthNumber++:(monthNumber=0,currentYear++);s()}()})),document.querySelector(".dashboard").appendChild(r)}function o(e,t,a){const n=document.querySelector(".alerta");n&&n.remove();const r=document.createElement("DIV");r.classList.add("alerta",t),r.textContent=e,a.parentElement.insertBefore(r,a.nextElementSibling),setTimeout(()=>{r.remove()},3e3)}function c(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}async function d(t){const{id:a,nombre:r,fecha:o,estado:d,proyectoid:i}=t,l=new FormData;l.append("id",a),l.append("nombre",r),l.append("fecha",o),l.append("estado",d),l.append("proyectoid",c());try{const t="http://localhost:3000/api/tareas/actualizar",c=await fetch(t,{method:"POST",body:l}),i=await c.json();if("exito"===i.respuesta.tipo){Swal.fire(i.respuesta.mensaje,i.respuesta.mensaje,"success");const t=document.querySelector(".modal");t&&t.remove(),e=e.map(e=>(e.id===a&&(e.estado=d,e.nombre=r,e.fecha=o),e)),n()}}catch(e){console.log(e)}}function i(e=!1,t={}){document.querySelector("#dates");let a=document.getElementById("month"),n=document.querySelector("#year");e?(a.innerHTML=monthName[convertDateJS(t.fecha).getMonth()],n.innerText=convertDateJS(t.fecha).getFullYear().toString(),function(e,t){let a=document.querySelector("#dates");for(let e=l();e>0;e--)a.innerHTML+=`<div class="calendar_day calendar_item calendar_last-days">\n        ${m(monthNumber-1)-(e-1)}</div>`;for(let n=1;n<=m(e);n++)n===convertDateJS(t.fecha).getDate()?a.innerHTML+=`<div class="calendar_day calendar_item calendar_edit">${n}</div>`:a.innerHTML+=`<div class="calendar_day calendar_item">${n}</div>`;f(e,convertDateJS(t.fecha).getDate())}(convertDateJS(t.fecha).getMonth(),t)):(a.innerHTML=monthName[monthNumber],n.innerText=currentYear.toString(),u(monthNumber))}function l(){let e=new Date(currentYear,monthNumber,1);return e.getDay()-1==-1?6:e.getDay()-1}function s(){currentDate.setFullYear(currentYear,monthNumber,currentDay),month.textContent=monthName[monthNumber],year.textContent=currentYear.toString(),dates.textContent="",u(monthNumber)}function m(e){return-1===e&&(e=11),0===e||2===e||4===e||6===e||7===e||9===e||11===e?31:3===e||5===e||8===e||10===e?30:currentYear%100!=0&&currentYear%4==0||currentYear%400==0?29:28}function u(e){let t=document.querySelector("#dates");for(let e=l();e>0;e--)t.innerHTML+=`<div class="calendar_day calendar_item calendar_last-days">\n        ${m(monthNumber-1)-(e-1)}</div>`;for(let a=1;a<=m(e);a++)t.innerHTML+=a===currentDay&&currentMonth===e+1?`<div class="calendar_day calendar_item calendar_today">${a}</div>`:`<div class="calendar_day calendar_item">${a}</div>`;f(e)}function f(e,t){document.querySelectorAll(".calendar_day.calendar_item").forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),dia=a.target.textContent,numeros.push(Number(dia)),selectMonth=e;let n=numeros.length-2,r=document.getElementsByClassName("calendar_edit");for(var o=0;o<r.length;o++)r[o].classList.remove("calendar_edit");if(dia>0&&(t.classList.add("calendar_selects"),t.classList.add(dia.toString()),t.classList.remove("calendar_no")),t.classList.contains(numeros[n]).toString()){let e=document.getElementsByClassName(numeros[n]);for(o=0;o<e.length;o++)e[o].classList.remove("calendar_selects"),e[o].classList.add("calendar_no")}})})}document.querySelectorAll('#filtros input[type="radio"]').forEach(e=>{e.addEventListener("input",a)})}();